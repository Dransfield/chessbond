<!DOCTYPE html>
<html>
  <head>
    <title>Chessbond</title>

    <!-- Viewport mobile tag for sensible mobile support -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

     
    <!--STYLES-->
    
    <!--STYLES END-->

    <!--Added this so the client has access to the csrf tag and it's grabbed first service side on every page -->


  </head>

  <body ng-app="HomepageModule" ng-controller="ProfileController"  style="display:none" id="mainContainer">
	    <% if (req.session.passport){ %>
			<% if (req.session.passport.user){ %>
			<div ng-init="getuser('<%-req.session.passport.user %>')"></div>
			<div ng-init="GetBlockedUsers('<%-req.session.passport.user %>')"></div>
						
           <% } %>
           <% } %>
	<div ng-init="CollectProfilePics()"></div>
				<% if (req.param('userID')) { %>
				<div ng-init="IncreaseViews('<%-req.param('userID')%>')"></div>
				<div ng-init="getLookedatUser('<%-req.param('userID')%>')"></div>
				    <% if (req.session.passport){ %>
						
						<% if (req.session.passport.user){ %>
						
							<div ng-init="GetInfo('<%-req.session.passport.user %>','<%-req.param('userID')%>',1)"></div>
						
						<% }else{ %>
								<div ng-init="GetInfo(0,'<%-req.param('userID')%>',2)"></div>
						<% } %>
					
						
						<% }else{ %>
								<div ng-init="GetInfo(0,'<%-req.param('userID')%>',3)"></div>
						<% } %>
					
				<% }else{ %>
				    <% if (req.session.passport){ %>
						<% if (req.session.passport.user){ %>
						<div ng-init="getLookedatUser('<%-req.session.passport.user %>')"></div>
						<div ng-init="IncreaseViews('<%-req.session.passport.user %>')"></div>
						<div ng-init="GetInfo('<%-req.session.passport.user %>','<%-req.session.passport.user %>',4)"></div>
						
						<% } %>
					<% } %>
				<% } %>

   <%- include partials/navbar.ejs %>
 <div style="display:flex"> 
   
    <span   class="jumbotron">
        <h1><b>{{LookedatUser.FideTitle}}  {{LookedatUser.name}}</b></h1>
      
      <% if (req.param('userID')) { %>

       <div >
	  <img ng-show="Accounts['<%-req.param('userID')%>'].online" ng-init="GetAccount('<%-req.param('userID')%>')" style="position:absolute;z-index: 2;" src="/images/greencirclesml.png"></img>
	   	 <img style="position:absolute;z-index: 2;"  ng-show="!Accounts['<%-req.param('userID') %>'].online" ng-init="GetAccount('<%-req.param('userID') %>')" src="/images/greycirclesml.png"></img>

	   <img style="position:relative;z-index: 1;" src="{{LookedatUser.picture}}"></img>
	
      </div>
      <% }else{ %>
		    <% if (req.session.passport){ %>
						<% if (req.session.passport.user){ %>
		  <div style="position: relative; left: 0; top: 0;">
				  <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts['<%-req.session.passport.user %>'].online" ng-init="GetAccount('<%-req.session.passport.user %>')" src="/images/greencirclesml.png"></img>
			  <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="!Accounts['<%-req.session.passport.user %>'].online" ng-init="GetAccount('<%-req.session.passport.user %>')" src="/images/greycirclesml.png"></img>
			
		   <img style="position:relative;z-index: 1;" src="{{LookedatUser.picture}}"></img>
    	</div>
    	
						<% } %>
					<% } %>
		  <% } %>
		
       
       
         <% if (req.param('userID') || req.session.passport) { %>
			
          <h2>Highest Difficulty Level Beaten:{{LookedatUser.DifficultyLevelBeaten}}</h2>
            <h2>ELO rating score:{{LookedatUser.ELO}}</h2>
         
           <% } %>
            <a href="/playvsai" class="btn btn-lg btn-success">Play Chess against the AI!</a>
	<br>
	<button type="button" class="btn btn-info btn-lg">Statistics</button>
	 </span>
	 <span>
    <table class="table table-striped">
              
			<thead>
                <tr>
	              <th></th>
                  <th></th>
                  </tr>
              </thead>
           <tbody>
				<tr>
					<td>
					Profile Views:
					</td>
					<td>
					{{LookedatUser.ProfileViews}}
					</td>
				</tr>
				<tr>
					<td>
					Registered member on:
					</td>
					<td>
						{{LookedatUser.Registeredmemberon}}
					</td>
				</tr>
				<tr>
					<td>
					Last login:
					</td>
					<td>
					{{LookedatUser.LastloginPhrase}}
					</td>
				</tr>
				<tr>
					<td>
					Number of times logged in:
					</td>
					<td>
					{{LookedatUser.Numberoftimesloggedin}}
					</td>
				</tr>
				<tr>
					<td>
					Gender:
					</td>
					<td>
			<% if (req.session.passport.user==req.param('userID') || !req.param('userID')){ %>
       			<button ng-click="editgender=!editgender" class="btn btn-sml">...
       			 <div ng-show ="editgender" style="display:flex">
				  <select class="form-control"
                  ng-model="User.Gender"
                  name="string"
                  multiple="string"
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('Gender','<%-req.session.passport.user%>',setGender)"
                  >
                  <option ng-repeat="gender in genders" value="{{gender}}">
                     {{gender}}
                  </option>
               </select>
               </button>
               <%}%>
					{{LookedatUser.Gender}}
					</td>
				</tr>
				<tr>
					<td>
					Date of birth:
					</td>
					<td>
			<% if (req.session.passport.user==req.param('userID') || !req.param('userID')){ %>
               	<button ng-click="editbirthday=!editbirthday" class="btn btn-sml">...
               <div ng-show="editbirthday" style="display:flex">
				  <select class="form-control"
                  ng-model="User.BirthDay"
                  name="string"
                  multiple="string"
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('BirthDay','<%-req.session.passport.user%>',setBirthday)"
                  >
                  <option ng-repeat="day in birthdays" value="{{day}}">
                     {{day}}
                  </option>
               </select>
				   <select class="form-control"
                  ng-model="User.BirthMonth"
                  name="string"
                  multiple="string"
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('BirthMonth','<%-req.session.passport.user%>',setBirthmonth)"
                  >
                  <option ng-repeat="month in birthmonths" value="{{month}}">
                     {{month}}
                  </option>
               </select>
				   <select class="form-control"
                  ng-model="User.BirthYear"
                  name="string"
                  multiple="string"
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('BirthYear','<%-req.session.passport.user%>',setBirthyear)"
                  >
                  <option ng-repeat="year in birthyears" value="{{year}}">
                     {{year}}
                  </option>
               </select>
              
                </div>
                </button>
                <%}%>
                {{LookedatUser.BirthDay}}
                /
					{{LookedatUser.BirthMonth}}
				/
					{{LookedatUser.BirthYear}}
					</td>
				</tr>
				<tr>
					<td>
					Current City:
					</td>
					<td>
						<% if (req.session.passport.user==req.param('userID') || !req.param('userID')){ %>
						<button ng-click="editcity=!editcity" class="btn btn-sml">...
						</button>
						 <input  ng-show="editcity" type="text"  class="form-control"  ng-keyup="PrefSelectChanged('CurrentCity','<%-req.session.passport.user%>',setCurrentCity)" ng-model="User.CurrentCity" />
						<!--<button ng-show="editcity" class="btn btn-sml" ng-click=" PrefSelectChanged('CurrentCity','<%-req.session.passport.user%>',setCurrentCity)">Done
						</button>-->
						
				 <%}%>
					{{LookedatUser.CurrentCity}}
					</td>
				</tr>
				<tr>
					<td>
					Fide Title:
					</td>
					<td>
						<% if (req.session.passport.user==req.param('userID') || !req.param('userID')){ %>
       			<button ng-click="editfidetitle=!editfidetitle" class="btn btn-sml">...
       			 <div ng-show ="editfidetitle" style="display:flex">
				  <select class="form-control"
                  ng-model="User.FideTitle"
                  name="string"
                  multiple="string"
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('FideTitle','<%-req.session.passport.user%>',setFideTitle)"
                  >
                  <option ng-repeat="fidetitle in fidetitles" value="{{fidetitle}}">
                     {{fidetitle}}
                  </option>
               </select>
               </button>
               <%}%>
					{{LookedatUser.FideTitle}}
					</td>
				</tr>
				<tr>
					<td>
					Valid Fide ID:
					</td>
					<td>
					{{LookedatUser.FideID}}
					</td>
				</tr>
				<tr>
					<td>
					Fide Ratings:
					</td>
					<td>
					{{LookedatUser.FideRatings}}
					</td>
				</tr>
			</tbody>
	</table>
  </span>
  </div>
  <div style="display:flex"> 
		<% if (req.session.passport){ %>
			<% if (req.session.passport.user){ %>
				
					<% if (req.session.passport.user==req.param('userID') || !req.param('userID')){ %>
   
					 <select ng-show="User" class="form-control" name="mySelect" id="mySelect"
					  ng-model="User.Country"
					  ng-change="PrefSelectChanged('Country','<%-req.session.passport.user%>',null)"
					  >
					  <option ng-repeat="c in countries track by $index" value="{{c.name}}">
						  {{c.name}}</option>
					 </select>
				<% } %>
			<% } %>
		<% } %>
	

		
		
	 <% if (req.param('userID') || req.session.passport) { %>
    <%- include partials/flag1.ejs %>
	<% } %>
	
	
	</div>
	<%var dograph=false;%>
	 <% if (req.param('userID')) { %>
	<% dograph=true;%>
	<%}%>
	<% if (req.session.passport) { %>
	<% if (req.session.passport.user) { %>
	
	<% dograph=true;%>
	<%}%>
	<%}%>
	
	<% if (dograph==true){%>
		
	
	
	 <div style="display:flex"> 
		 <span>
	 <h2 class="sub-header">Recent Games</h2>
          <div   class="table-responsive">
            <table class="table table-striped">
              
		
			<thead>
                <tr>
	              <th>White</th>
                  <th>Black</th>
                  <th>Result</th>
                  <th>Time</th>
                  <th>Moves</th>
                  <th>Date</th>
                  <th>Action</th>
				<!--HEADERS OF TABLE-->
                </tr>
           </thead>
           <tbody>
				  
            <tr ng-repeat="game in GameInfo track by $index">
				<span ng-init="GetAccount(game.WhitePlayerID)">
			<span ng-init="GetAccount(game.BlackPlayerID)">
			<td><img src="{{game.WhiteAvatar}}"></img><a href="/profile/{{game.WhitePlayerID}}" target="_blank"><b style="color:red">{{Accounts[game.WhitePlayerID].FideTitle}}</b> {{game.WhitePlayerName}}</a>({{game.WhiteELO}})</td>
			<td><img src="{{game.BlackAvatar}}"><a href="/profile/{{game.BlackPlayerID}}" target="_blank"><b style="color:red">{{Accounts[game.BlackPlayerID].FideTitle}}</b>  {{game.BlackPlayerName}}</a>({{game.BlackELO}})</td>
			<td>{{game.res}}</td>
			<td>{{game.timelimit}}|0</td>
			<td>{{game.moves}}</td>
			<td>{{game.date}}</td>
			<td><a href="/humanvshuman/{{game.id}}" target="_blank">Link</a></td>
			
			
			<tr>
			</tr>
            </tbody>
            </table>
            	<div class="btn btn-lg btn-success" ng-show="chessgameskip>0" ng-click="GetOlderChessGames(LookedatUser.id)"><</div>
				<div class="btn btn-lg btn-success" ng-click="GetMoreChessGames(LookedatUser.id)">></div>

          </div>
          </span>
    <% } %>
	<span>
		<h2>Who am I?</h2>
		<h2>My Wall</h2>
	<% if (req.session.passport) { %>
	<% if (req.session.passport.user) { %>
	<form ng-submit="SendWallPost('<%- req.session.passport.user %>')">
	<input type="text" autocomplete="off" class="form-control" placeholder="post to wall" name="name" ng-model="WallPostInput"  required>
	<button class="btn btn-default btn-sm" type="submit" >Post to Wall</button>
	
	</form>
	<% } %>
	<% } %>
	<table>
   <tr ng-repeat="wllpsts in WallPosts track by $index">
	
	<td >
		
		<div style="display:flex">
		<span style="position:relative;" >
		<img style="position:absolute;z-index:2;bottom: -4px;" src="/images/greycirclesml.png" ng-show="!Accounts[wllpsts.sender].online" ng-init="GetAccount(wllpsts.sender)" >
		
		<img style="position:absolute;z-index:2;bottom: -4px;" src="/images/greencirclesml.png" ng-show="Accounts[wllpsts.sender].online" ng-init="GetAccount(wllpsts.sender)" >
		<img style="position:relative;z-index:1;" src="{{wllpsts.senderpic}}"></span>
		<span> <span ng-show="!BlockedUsers[wllpsts.sender]">{{wllpsts.content}}</span>
		<br>by <a href="/profile/{{wllpsts.sender}}" target="_blank"><b style="color:red">{{Accounts[wllpsts.sender].FideTitle}}</b> {{wllpsts.sendername}}</a> {{wllpsts.Age}}
		</span>
	<% if (req.session.passport) { %>
	<% if (req.session.passport.user) { %>
		<div><button type="submit" style='height:50%' class="btn btn-default btn-sm" ng-show="!ShowReply[$index]" ng-click="ShowReply[$index]=!ShowReply[$index]">Reply</button></div>
		<div><button type="submit" ng-show="User.id==LookedatUser.id" ng-click="DeleteWallPost(wllpsts.id)" class="btn btn-default btn-sm">Delete</button></div>
		<div><button type="submit" ng-show="!BlockedUsers[wllpsts.sender]" ng-click="BlockUser('<%- req.session.passport.user %>',wllpsts.sender)" class="btn btn-default btn-sm">Block User</button></div>
		<div><button type="submit" ng-show="BlockedUsers[wllpsts.sender]" ng-click="UnBlockUser('<%- req.session.passport.user %>',wllpsts.sender)" class="btn btn-default btn-sm">UnBlock User</button></div>
		
		
		<div ng-show="ShowReply[$index]">
	

		<input type="text" autocomplete="off" class="form-control" placeholder="reply" name="name" ng-model="WallPostReplyInput[$index]"  required>
		<button type="submit" ng-click="SendWallPostReply(wllpsts.sender,'<%- req.session.passport.user %>',WallPostReplyInput[$index],wllpsts.id)" class="btn btn-warning btn-sm">Reply</button>
		</div>
		<% } %>
	<% } %>
	</div>
	
	
		
		<table>
			<tr>
				<td ng-show="wllpsts.Replies[0]">
					Replies:
				</td>
			</tr>
		<tr ng-repeat="rply in wllpsts.Replies track by $index">
			<td>
				</td>
				<td>
			<div style="display:flex">
		<span style="position: relative; left: 0; top: 0;">
			
		<img ng-show="Accounts[rply.sender].online" ng-init="GetAccount(rply.sender)"  style="position:absolute;z-index:2;bottom:-3px;" src="/images/greencirclesml.png">
		<img ng-show="!Accounts[rply.sender].online" ng-init="GetAccount(rply.sender)"  style="position:absolute;z-index:2;bottom:-3px;" src="/images/greycirclesml.png">
		
		<img src="{{rply.senderpic}}"></span>
		<span><span ng-show="!BlockedUsers[rply.sender]">{{rply.content}}</span>
		<br>by <a href="/profile/{{rply.sender}}" target="_blank">{{Accounts[wllpsts.sender].FideTitle}} {{rply.sendername}}</a> {{rply.Age}}
		</span>
		</div>
		</td>
			</tr>
		</table>
	
	<hr>
		
	</td>
	
	
	
	</tr>
	</table>
		<div class="btn btn-lg btn-success" ng-show="wallpostskip>0" ng-click="GetOlderWallPosts(LookedatUser.id)"><</div>
<div class="btn btn-lg btn-success" ng-click="GetMoreWallPosts(LookedatUser.id)">></div>

	
</span>
</div>
    <!--SCRIPTS-->

    <!--SCRIPTS END-->
  </body>
</html>
