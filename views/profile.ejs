<!DOCTYPE html>
<html>
  <head>
    <title>Chessbond</title>

    <!-- Viewport mobile tag for sensible mobile support -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

     
    <!--STYLES-->
     <link rel="stylesheet" href="/styles/angular-toastr.css">
        <link rel="stylesheet" href="/styles/bootstrap.3.1.1.css">
        <link rel="stylesheet" href="/styles/chessboard-0.3.0.css">
        <link rel="stylesheet" href="/styles/importer.css">
    <!--STYLES END-->

    <!--Added this so the client has access to the csrf tag and it's grabbed first service side on every page -->


  </head>

  <body ng-app="HomepageModule"  ng-mousemove="MouseWasMoved()" ng-controller="ProfileController" style="display:none"  id="mainContainer">

	 <% var lookedatuser; %>
	<% if (req.param('userID')){ %>
			<% lookedatuser=req.param('userID'); %>
		
		<% } %>
		
	  
	  <% if (req.session.passport){ %>
	  <% if (req.session.passport.user){ %>
	<% if (!req.param('userID')){ %>
		<% lookedatuser=  req.session.passport.user;%>
	  <% } %>
      <% } %>
	<% } %>
	"Looked at user idle" {{Accounts['<%-lookedatuser %>'].idle}}
	$scope.SetIdle{{$scope.SetIdle}}
	<%- include partials/navbar.ejs %>
	<div ng-init="JoinIdleNotificationRoom('<%-req.session.passport.user %>')"></div>
			
	   <% if (req.session.passport){ %>
			<% if (req.session.passport.user){ %>
			<div ng-init="getuser('<%-req.session.passport.user %>')"></div>
			<div ng-init="GetBlockedUsers('<%-req.session.passport.user %>')"></div>
						
           <% } %>
           <% } %>
	
	
				
				<div ng-init="IncreaseViews('<%-lookedatuser %>')"></div>
				<div ng-init="getLookedatUser('<%- lookedatuser %>')"></div>
				 <div ng-init="GetInfo('<%-lookedatuser %>')"></div>
	
	<div ng-show="User.name=='keith ashford'">
	<button ng-click="GetFile()">Get</button>
	</div>
	
	 <div style="display:flex"> 
   
    <span   class="jumbotron">
        <h1><b style="color:red">{{LookedatUser.FideTitle}}</b>  {{LookedatUser.name}}</h1>
      
     
     	 <% if(lookedatuser==req.session.passport.user){%>
    	<div ng-show="LookedatUser.avatarid">
		<img style="width:250px" ng-src="/user/avatar/{{LookedatUser.avatarid}}">
		</div>
    	
		<form action="/uploadavatar" enctype="multipart/form-data" method="post">
    <input type="file" name="avatar" multiple="multiple"><br>
    <input type="submit" value="Upload">
    </form>'
    	
    	<% } %>
			-->
		  <div ng-show="LookedatUser.picture" style="position: relative; left: 0; top: 0;">
			<img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts['<%-lookedatuser %>'].online && !Accounts['<%-lookedatuser %>'].idle" ng-init="GetAccount('<%-lookedatuser %>')" src="/images/greencirclesml.png"></img>
		  	<img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts['<%-lookedatuser %>'].online && Accounts['<%-lookedatuser %>'].idle" ng-init="GetAccount('<%-lookedatuser %>')" src="/images/orangecirclesml.png"></img>
		  
		   <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="!Accounts['<%-lookedatuser %>'].online" ng-init="GetAccount('<%- lookedatuser %>')" src="/images/greycirclesml.png"></img>
		   <img class="profilepic" src="{{LookedatUser.picture}}"></img>
    	</div>
	
	<h2>Highest Difficulty Level Beaten:{{LookedatUser.DifficultyLevelBeaten}}</h2>
            <h2>ELO rating score:{{LookedatUser.ELO}}</h2>
         
            <a href="/playvsai" class="btn btn-lg btn-success">Play Chess against the AI!</a>
	<br><a href="/" class="btn btn-lg btn-success">Create a New vs Human Game</a>
	<button type="button" class="btn btn-info btn-lg">Statistics</button>
	 </span>
	 <span>
    <table class="table table-striped">
              
			<thead>
                <tr>
	              <th></th>
                  <th></th>
                  </tr>
              </thead>
           <tbody>
				<tr>
					<td>
					Profile Views:
					</td>
					<td>
					{{LookedatUser.ProfileViews}}
					</td>
				</tr>
				<tr>
					<td>
					Registered member on:
					</td>
					<td>
						{{LookedatUser.Registeredmemberon}}
					</td>
				</tr>
				<tr>
					<td>
					Last login:
					</td>
					<td>
					{{LookedatUser.LastloginPhrase}}
					</td>
				</tr>
				<tr>
					<td>
					Number of times logged in:
					</td>
					<td>
					{{LookedatUser.Numberoftimesloggedin}}
					</td>
				</tr>
				<tr>
					<td>
					Gender:
					</td>
					<td>
			<% if (req.session.passport){ %>
       		<% if (req.session.passport.user==lookedatuser){ %>
       			<button ng-click="editgender=!editgender" class="btn btn-sml">...
       			 <div ng-show ="editgender" style="display:flex">
				  <select class="form-control"
                  ng-model="User.Gender"
                  name="string"
                  
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('Gender','<%-req.session.passport.user%>',setGender)"
                  >
                  <option ng-repeat="gender in genders" value="{{gender}}">
                     {{gender}}
                  </option>
               </select>
               </button>
               <%}%>
			   <%}%>
			
					{{LookedatUser.Gender}}
					</td>
				</tr>
				<tr>
					<td>
					Date of birth:
					</td>
					<td>
			<% if (req.session.passport){ %>
       		<% if (req.session.passport.user==lookedatuser){ %>
               	<button ng-click="editbirthday=!editbirthday" class="btn btn-sml">...
               </button>
               <div ng-show="editbirthday" style="display:flex">
				  <select class="form-control"
                  ng-model="User.BirthDay"
                  name="string"
                  
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('BirthDay','<%-req.session.passport.user%>',setBirthday)"
                  >
                  <option ng-repeat="day in birthdays" value="{{day}}">
                     {{day}}
                  </option>
               </select>
				   <select class="form-control"
                  ng-model="User.BirthMonth"
                  name="string"
                  
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('BirthMonth','<%-req.session.passport.user%>',setBirthmonth)"
                  >
                  <option ng-repeat="month in birthmonths" ng-value="{{month.name}}">
                     {{month.name}}
                  </option>
               </select>
				   <select class="form-control"
                  ng-model="User.BirthYear"
                  name="string"
                  
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('BirthYear','<%-req.session.passport.user%>',setBirthyear)"
                  >
                  <option ng-repeat="year in birthyears" value="{{year}}">
                     {{year}}
                  </option>
               </select>
              
                </div>
                
                <%}%>
                <%}%>
            
                {{LookedatUser.BirthDay}}
                /
					{{LookedatUser.BirthMonth}}
				/
					{{LookedatUser.BirthYear}}
					</td>
				</tr>
				<tr>
					<td>
					Current City:
					</td>
					<td>
				<% if (req.session.passport){ %>
				<% if (req.session.passport.user==lookedatuser){ %>
						<button ng-click="editcity=!editcity" class="btn btn-sml">...
						</button>
						 <input  ng-show="editcity" type="text"  class="form-control"  ng-change="GetCities()" ng-model="TypedCity" />
						  <select ng-show="editcity" class="form-control"
                  ng-model="User.CurrentCity"
                  name="string"
                  size="2"
                  required="string"
                  ng-selected="FoundCities[0]"
                  ng-required="string"
                  ng-change="PrefSelectChanged('CurrentCity','<%-req.session.passport.user%>',setCity)"
                  >
						<option ng-repeat="cit in FoundCities" value="{{cit.city}}">
                     {{cit.city}} {{cit.country}}
                  </option>
					</select>
						<!-- <input  ng-show="editcity" type="text"  class="form-control"  ng-keyup="PrefSelectChanged('CurrentCity','<%-req.session.passport.user%>',setCurrentCity)" ng-model="User.CurrentCity" />
						<button ng-show="editcity" class="btn btn-sml" ng-click=" PrefSelectChanged('CurrentCity','<%-req.session.passport.user%>',setCurrentCity)">Done
						</button>-->
						
				 <%}%>
				<%}%>
					{{LookedatUser.CurrentCity}}
					</td>
				</tr>
				<tr>
					<td>
					Fide Title:<br>(Self Claimed:)
					</td>
					<td>
			<% if (req.session.passport){ %>
       		<% if (req.session.passport.user==lookedatuser){ %>
       			<button ng-click="editfidetitle=!editfidetitle" class="btn btn-sml">...
       			 <div ng-show ="editfidetitle" style="display:flex">
				  <select class="form-control"
                  ng-model="User.FideTitle"
                  name="string"
                  
                  required="string"
                  ng-required="string"
                  ng-change="PrefSelectChanged('FideTitle','<%-req.session.passport.user%>',setFideTitle)"
                  >
                  <option ng-repeat="fidetitle in fidetitles" value="{{fidetitle}}">
                     {{fidetitle}}
                  </option>
               </select>
               </button>
               <%}%>
               <%}%>
					{{LookedatUser.FideTitle}}
					</td>
				</tr>
				<tr>
					<td>
					Valid Fide ID:
					</td>
					<td>
				<% if (req.session.passport){ %>
					<% if (req.session.passport.user==lookedatuser){ %>
						<button ng-click="editfideid=!editfideid" class="btn btn-sml">...
						</button>
						 <input  ng-show="editfideid" type="number"  class="form-control"  ng-change="ChangePreference('FideID','<%-req.session.passport.user%>',LookedatUser.FideID)" ng-model="LookedatUser.FideID" />
					
					<%}%>
				<%}%>
			    	{{LookedatUser.FideID}}
					</td>
				</tr>
				<tr>
					<td>
					Fide Ratings:
					</td>
					<td>
						<% if (req.session.passport){ %>
					<% if (req.session.passport.user==lookedatuser){ %>
					<button ng-click="editfideratings=!editfideratings" class="btn btn-sml">...
						</button>
						 <input  ng-show="editfideratings" type="number"  class="form-control"  ng-change="ChangePreference('FideRatings','<%-req.session.passport.user%>',LookedatUser.FideRatings,ProfileWasUpdated)" ng-model="LookedatUser.FideRatings" />
				
					<%}%>
				<%}%>
					{{LookedatUser.FideRatings}}
					</td>
				</tr>
					<tr>
					<td>
					Profile Updated:
					</td>
					<td>
					{{LookedatUser.ProfileUpdatedPhrase}}
					</td>
				</tr>
			</tbody>
	</table>
  </span>
  </div>
<%- include partials/flag1.ejs %>


	 
  <div style="display:flex"> 
		<% if (req.session.passport){ %>
			<% if (req.session.passport.user){ %>
				
					<% if (req.session.passport.user==lookedatuser){ %>
   
					 <select ng-show="User" class="form-control" name="mySelect" id="mySelect"
					  ng-model="User.Country"
					  ng-change="PrefSelectChanged('Country','<%-req.session.passport.user%>',null)"
					  >
					  <option ng-repeat="c in countries track by $index" value="{{c.name}}">
						  {{c.name}}</option>
					 </select>
				<% } %>
			<% } %>
		<% } %>
	
	</div>
	 <div style="display:flex"> 
		 <span>
	 <h2 class="sub-header">Recent Games</h2>
          <div   class="table-responsive">
            <table class="table table-striped">
              
		
			<thead>
                <tr>
	              <th>White</th>
                  <th>Black</th>
                  <th>Result</th>
                  <th>Time</th>
                  <th>Moves</th>
                  <th>Date</th>
                  <th>Action</th>
				<!--HEADERS OF TABLE-->
                </tr>
           </thead>
           <tbody>
				  
            <tr ng-repeat="game in GameInfo track by $index">
			<span ng-init="GetAccount(game.WhitePlayerID)">
			<span ng-init="GetAccount(game.BlackPlayerID)">
					<img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[game.WhitePlayerID].online && Accounts[game.WhitePlayerID].idle" ng-init="GetAccount(game.WhitePlayerID)" src="/images/orangecirclesml.png"></img>
		  <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[game.WhitePlayerID].online && !Accounts[game.WhitePlayerID].idle" ng-init="GetAccount(game.WhitePlayerID)" src="/images/greencirclesml.png"></img>
				 <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[game.WhitePlayerID].online" ng-init="GetAccount(game.WhitePlayerID)" src="/images/greycirclesml.png"></img>
				
			<td><img class="profilepic" src="{{game.WhiteAvatar}}"></img><a href="/profile/{{game.WhitePlayerID}}" target="_blank"><b style="color:red">{{Accounts[game.WhitePlayerID].FideTitle}}</b> {{game.WhitePlayerName}}</a>({{game.WhiteELO}})</td>
				
				<img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[game.BlackPlayerID].online && Accounts[game.BlackPlayerID].idle" ng-init="GetAccount(game.BlackPlayerID)" src="/images/orangecirclesml.png"></img>
		  <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[game.BlackPlayerID].online && !Accounts[game.BlackPlayerID].idle" ng-init="GetAccount(game.BlackPlayerID)" src="/images/greencirclesml.png"></img>
				 <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[game.BlackPlayerID].online" ng-init="GetAccount(game.BlackPlayerID)" src="/images/greycirclesml.png"></img>
				
			<td><img class="profilepic" src="{{game.BlackAvatar}}"><a href="/profile/{{game.BlackPlayerID}}" target="_blank"><b style="color:red">{{Accounts[game.BlackPlayerID].FideTitle}}</b>  {{game.BlackPlayerName}}</a>({{game.BlackELO}})</td>
			<td>{{game.res}}</td>
			<td>{{game.timelimit}}|0</td>
			<td>{{game.moves}}</td>
			<td>{{game.date}}</td>
			<td><a href="/humanvshuman/{{game.id}}" target="_blank">Link</a></td>
			
			
			<tr>
			</tr>
            </tbody>
            </table>
            	<div class="btn btn-lg btn-success" ng-show="chessgameskip>0" ng-click="GetOlderChessGames(LookedatUser.id)"><</div>
				<div class="btn btn-lg btn-success" ng-click="GetMoreChessGames(LookedatUser.id)">></div>

          </div>
          </span>
  
	<span>
		<h2>Who am I?</h2>
		<h2>My Wall</h2>
	<% if (req.session.passport) { %>
	<% if (req.session.passport.user) { %>
	<form ng-submit="SendWallPost('<%- req.session.passport.user %>')">
	<input type="text" autocomplete="off" class="form-control" placeholder="post to wall" name="name" ng-model="WallPostInput"  required>
	<button class="btn btn-default btn-sm" type="submit" >Post to Wall</button>
	
	</form>
	<% } %>
	<% } %>
	<table>
   <tr ng-repeat="wllpsts in WallPosts track by $index">
	
	<td >
		
					<div style="display:flex">
		<span style="position: relative; left: 0; top: 0;">
			
		<img ng-show="Accounts[wllpsts.sender].online && !Accounts[wllpsts.sender].idle" ng-init="GetAccount(wllpsts.sender)"  style="position:absolute;z-index:2;bottom:-3px;" src="/images/greencirclesml.png">
		<img ng-show="Accounts[wllpsts.sender].online && Accounts[wllpsts.sender].idle" ng-init="GetAccount(wllpsts.sender)"  style="position:absolute;z-index:2;bottom:-3px;" src="/images/orangecirclesml.png">
		
		<img ng-show="!Accounts[wllpsts.sender].online" ng-init="GetAccount(wllpsts.sender)"  style="position:absolute;z-index:2;bottom:-3px;" src="/images/greycirclesml.png">
		
		<img class="profilepic" src="{{Accounts[wllpsts.sender].picture}}"></img></span>
		<span><span ng-show="!BlockedUsers[wllpsts.sender]">{{wllpsts.content}}</span>
		<br>by <a href="/profile/{{wllpsts.sender}}" target="_blank"><b style="color:red">{{Accounts[wllpsts.sender].FideTitle}}</b> {{wllpsts.sendername}}</a> {{wllpsts.Age}}
		</span>
		</div>
		
		  
    			

		

		
		
	<% if (req.session.passport) { %>
	<% if (req.session.passport.user) { %>
		<div><button type="submit" style='height:50%' class="btn btn-default btn-sm" ng-show="!ShowReply[$index]" ng-click="ShowReply[$index]=!ShowReply[$index]">Reply</button></div>
		<div><button type="submit" ng-show="User.id==LookedatUser.id" ng-click="DeleteWallPost(wllpsts.id)" class="btn btn-default btn-sm">Delete</button></div>
		<div><button type="submit" ng-show="!BlockedUsers[wllpsts.sender]" ng-click="BlockUser('<%- req.session.passport.user %>',wllpsts.sender)" class="btn btn-default btn-sm">Block User</button></div>
		<div><button type="submit" ng-show="BlockedUsers[wllpsts.sender]" ng-click="UnBlockUser('<%- req.session.passport.user %>',wllpsts.sender)" class="btn btn-default btn-sm">UnBlock User</button></div>
		
		
		<div ng-show="ShowReply[$index]">
	

		<input type="text" autocomplete="off" class="form-control" placeholder="reply" name="name" ng-model="WallPostReplyInput[$index]"  required>
		<button type="submit" ng-click="SendWallPostReply(wllpsts.sender,'<%- req.session.passport.user %>',WallPostReplyInput[$index],wllpsts.id)" class="btn btn-warning btn-sm">Reply</button>
		</div>
		<% } %>
	<% } %>
	</div>
	
	
		
		<table>
			<tr>
				<td ng-show="wllpsts.Replies[0]">
					Replies:
				</td>
			</tr>
		<tr ng-repeat="rply in wllpsts.Replies track by $index">
			<td>
				</td>
				<td>
			<div style="display:flex">
		<span style="position: relative; left: 0; top: 0;">
			<img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[rply.sender].online && Accounts[rply.sender].idle" ng-init="GetAccount(rply.sender)" src="/images/orangecirclesml.png"></img>
		  <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[rply.sender].online && !Accounts[rply.sender].idle" ng-init="GetAccount(rply.sender)" src="/images/greencirclesml.png"></img>
				 <img style="position:absolute;z-index: 2;bottom: -4px;"  ng-show="Accounts[rply.sender].online" ng-init="GetAccount(rply.sender)" src="/images/greycirclesml.png"></img>
				
		<img class="profilepic" src="{{rply.senderpic}}"></span>
		<span><span ng-show="!BlockedUsers[rply.sender]">{{rply.content}}</span>
		<br>by <a href="/profile/{{rply.sender}}" target="_blank"><b style="color:red">{{Accounts[rply.sender].FideTitle}}</b> {{rply.sendername}}</a> {{rply.Age}}
		</span>
		</div>
		</td>
			</tr>
		</table>
	
	<hr>
		
	</td>
	
	
	
	</tr>
	</table>
		<div class="btn btn-lg btn-success" ng-show="wallpostskip>0" ng-click="GetOlderWallPosts(LookedatUser.id)"><</div>
<div class="btn btn-lg btn-success" ng-click="GetMoreWallPosts(LookedatUser.id)">></div>

	
</span>
</div>
			

    <!--SCRIPTS-->
  <script src="/js/dependencies/sails.io.js"></script>
        <script src="/js/dependencies/angular.1.3.js"></script>
         <script src="/js/dependencies/angular-sanitize.js"></script>
        <script src="/js/dependencies/jquery-1.10.1.min.js"></script>
        <script src="/js/dependencies/chessboard-0.3.0.js"></script>
        <script src="/js/dependencies/chess.min.js"></script>
        <script src="/js/dependencies/stockfish.js"></script>
        <script src="/js/dependencies/angular-toastr.js"></script>
        <script src="/js/dependencies/bootstrap.min.js"></script>
        <script src="/js/dependencies/compareTo.module.js"></script>
        <script src="/js/dependencies/enginegame.js"></script>
        <script src="/js/HomepageModule.js"></script>
        <script src="/js/HomepageController.js"></script>
      <script src="/js/ProfileController.js"></script>
        <script src="/js/RegisterController.js"></script>
        <script src="/js/SinglePlayerController.js"></script>
        <script src="/js/TwoPlayerController.js"></script>
    <!--SCRIPTS END-->
  </body>
</html>
